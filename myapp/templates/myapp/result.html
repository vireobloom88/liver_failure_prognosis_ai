{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>予測結果</title>
    <link rel="stylesheet" href="{% static 'myapp/style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">

    <h2>予測結果</h2>

    <div class="flex-row">

        {% with data=results.ランダムフォレスト %}
        <div class="model-box">
            <h3>ランダムフォレスト</h3>
            <p>予測：<strong>{{ data.prediction }}</strong></p>
            <p>予測確率：{{ data.probability }}%</p>

            <a href="{% url 'rf_importance' %}" class="back-btn">
                特徴量寄与度
            </a>
        </div>
        {% endwith %}

        {% with data=results.EBM %}
        <div class="model-box">
            <h3>EBM</h3>
            <p>予測：<strong>{{ data.prediction }}</strong></p>
            <p>予測確率：{{ data.probability }}%</p>

            <a href="{% url 'ebm_importance' %}" class="back-btn">
                特徴量寄与度
            </a>
        </div>
        {% endwith %}

        {% with data=results.CatBoost %}
        <div class="model-box">
            <h3>CatBoost</h3>
            <p>予測：<strong>{{ data.prediction }}</strong></p>
            <p>予測確率：{{ data.probability }}%</p>

            <a href="{% url 'cb_importance' %}" class="back-btn">
                特徴量寄与度
            </a>
        </div>
        {% endwith %}

        {% with data=results.決定木 %}
        <div class="model-box">
            <h3>決定木</h3>
            <p>予測：<strong>{{ data.prediction }}</strong></p>
            <p>予測確率：{{ data.probability }}%</p>

            <a href="{% url 'dt_importance' %}" class="back-btn">
                特徴量寄与度
            </a>
        </div>
        {% endwith %}

    </div>

    <h2>検証データでの性能</h2>

    <div class="chart-container">
        <h3>1.正解率（Accuracy）</h3>
        <p style="font-size: 0.9em; color: #555; margin-top: 5px;">
            予測結果と実際の転帰が一致した割合
        </p>
        <canvas id="accuracyChart"></canvas>
    </div>

    <div class="chart-container">
        <h3>2.死亡見逃し率（False Negative Rate）</h3>
        <p style="font-size: 0.9em; color: #555; margin-top: 5px;">
            死亡と予測して実際に死亡であった割合
        </p>
        <canvas id="fnrChart"></canvas>
    </div>

    <a href="{% url 'index' %}" class="back-btn">入力画面に戻る</a>

</div>

<script>
    const barColors = ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0'];

    new Chart(document.getElementById('accuracyChart'), {
        type: 'bar',
        data: {
            labels: ['ランダムフォレスト', 'EBM', 'CatBoost', '決定木'],
            datasets: [{ data: [0.837, 0.833, 0.830, 0.800], backgroundColor: barColors }]
        },
        options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: { x: { min: 0, max: 1 } }
        }
    });

    new Chart(document.getElementById('fnrChart'), {
        type: 'bar',
        data: {
            labels: ['ランダムフォレスト', 'EBM', 'CatBoost', '決定木'],
            datasets: [{ data: [0.015, 0.021, 0.031, 0.051], backgroundColor: barColors }]
        },
        options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: { x: { min: 0, max: 0.1 } }
        }
    });
</script>

</body>
</html>